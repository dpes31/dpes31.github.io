<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주택 투자 시뮬레이터</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* (디자인 스타일은 이전과 동일하게 유지) */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
        .input-group input[type="number"]::-webkit-outer-spin-button,
        .input-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        .input-group input[type="number"] { -moz-appearance: textfield; }
        .result-box {
            background-color: #f3f4f6; 
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        /* 버튼 스타일 */
        .calculate-button {
            transition: background-color 0.3s ease;
        }
        /* DSR 비율 및 주석 작은 글씨 스타일 */
        .small-text-note {
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* text-gray-500 */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1e40af', 
                        'secondary-gray': '#f3f4f6',
                        'accent-red': '#dc2626',
                        'accent-green': '#10b981',
                        'accent-orange': '#f97316',
                    },
                }
            }
        }

        let activeMode = 'general';
        
        // (재무 함수 동일)
        const calculateMonthlyRate = (annualRate) => annualRate / 12;
        const calculateMonthlyPayment = (P, r_m, m) => {
            if (r_m === 0) return P / m;
            const term = Math.pow(1 + r_m, m);
            return P * (r_m * term) / (term - 1);
        };
        const calculateMaxLoanAmount = (A, r_m, m) => {
            if (r_m === 0) return A * m;
            const term = Math.pow(1 + r_m, m);
            return A * (term - 1) / (r_m * term);
        };
        const formatToBillion = (amount, decimals = 2) => {
            if (isNaN(amount) || amount === null || amount === undefined) return '0.00억';
            const billion = amount / 100000000;
            return `${billion.toFixed(decimals)}억`;
        };
        const formatToPercent = (rate) => {
            if (isNaN(rate) || rate === null || amount === undefined) return '0%';
            return `${(rate * 100).toFixed(0)}%`;
        };
        const formatToWon = (amount) => {
            if (isNaN(amount) || amount === null || amount === undefined) return '0 원';
            return `${Math.round(amount).toLocaleString()} 원`;
        }

        // --- 공통 입력값 파싱 ---
        const getCommonInputs = () => {
            // NOTE: 입력 오류 수정 (30->29.9 문제)을 위해 Number()를 사용하여 정확하게 파싱
            const income = Number(document.getElementById('income').value) * 100000000 || 0;
            const funds = Number(document.getElementById('funds').value) * 100000000 || 0;
            const interestRate = Number(document.getElementById('interestRate').value) / 100 || 0.045;
            const loanTerm = parseInt(document.getElementById('loanTerm').value) || 30;
            const isRegulated = document.getElementById('isRegulated').value;
            
            const monthlyRate = calculateMonthlyRate(interestRate);
            const totalMonths = loanTerm * 12;

            return { 
                income, 
                funds, 
                interestRate, 
                loanTerm,     
                isRegulated, 
                monthlyRate, 
                totalMonths,
                ltvRatio: isRegulated === 'Y' ? 0.50 : 0.70
            };
        }

        // --- 모드별 계산 로직 ---

        // 1. 일반 주택 매매 계산 (DSR 초과 시 최대 대출액 표시 로직 적용)
        const calculateGeneral = (common) => {
            // NOTE: 입력 오류 수정 (30->29.9 문제)을 위해 Number()를 사용하여 정확하게 파싱
            const price = Number(document.getElementById('price').value) * 100000000 || 0;
            
            // 1. DSR 및 LTV 파라미터
            const dsrLimit = 0.40;
            const ltvRatio = common.ltvRatio;
            
            // A. LTV 기준 최대 대출액
            const ltvMaxLoan = price * ltvRatio;

            // B. DSR 허용 연간 상환액
            const dsrMaxAnnualPayment = common.income * dsrLimit;
            const dsrMaxMonthlyPayment = dsrMaxAnnualPayment / 12;

            // C. DSR 기준 최대 대출액 (은행이 빌려줄 수 있는 최대치)
            let dsrMaxLoan = 0;
            if (common.monthlyRate > 0) {
                 dsrMaxLoan = calculateMaxLoanAmount(dsrMaxMonthlyPayment, common.monthlyRate, common.totalMonths);
            } else if (common.totalMonths > 0) {
                dsrMaxLoan = dsrMaxMonthlyPayment * common.totalMonths;
            }

            // D. 필요 대출 금액 (매매가 - 보유자금)
            const requiredLoan = Math.max(0, price - common.funds);

            // E. '필요 대출액' 기준 연간 상환액
            let requiredAnnualPayment = 0;
            if (requiredLoan > 0 && common.monthlyRate > 0) {
                const requiredMonthlyPayment = calculateMonthlyPayment(requiredLoan, common.monthlyRate, common.totalMonths);
                requiredAnnualPayment = requiredMonthlyPayment * 12;
            } else if (requiredLoan > 0 && common.totalMonths > 0) {
                requiredAnnualPayment = (requiredLoan / common.totalMonths) * 12;
            }

            // F. DSR 대비 초과 비율 (필요 대출액 기준)
            const dsrRatio = (dsrMaxAnnualPayment > 0) ? (requiredAnnualPayment / dsrMaxAnnualPayment) : 0;
            
            // G. 은행 최대 한도 (DSR과 LTV 중 작은 값)
            const bankMaxLoan = Math.min(ltvMaxLoan, dsrMaxLoan);

            // H. 최종 대출금 결정 및 문구 설정
            let finalLoan = 0;
            let maxLoanDisplay = '';
            let maxLoanColor = 'text-gray-900';
            let maxLoanNote = '';

            if (requiredLoan === 0) {
                // 필요 대출액 0
                finalLoan = 0;
                maxLoanDisplay = `대출 필요 없음`;
                maxLoanColor = 'text-accent-green';
            } else if (dsrRatio <= 1) {
                // DSR 한도 이내: 필요 대출액과 은행 최대 한도 중 작은 금액으로 대출
                finalLoan = Math.min(requiredLoan, bankMaxLoan);
                maxLoanDisplay = formatToBillion(finalLoan);
                maxLoanColor = 'text-accent-green';
                // *** 수정됨: DSR 비율 작은 글씨로 표기 ***
                maxLoanNote = `<span class="small-text-note">(DSR 비율: ${dsrRatio.toFixed(2)}배)</span>`;
            } else {
                // DSR 한도 초과: 은행 최대 한도(DSR/LTV)만큼만 대출 가능
                finalLoan = bankMaxLoan; 
                maxLoanDisplay = formatToBillion(finalLoan);
                maxLoanColor = 'text-accent-red';
                // *** 수정됨: DSR 비율 및 '필요 대출액 불가' 문구 작은 글씨로 표기 ***
                maxLoanNote = `<span class="small-text-note">(DSR 비율: ${dsrRatio.toFixed(2)}배)</span><span class="small-text-note block mt-1 font-bold text-accent-red">※ 필요 대출액 불가</span>`;
            }
            
            // I. 최종 월 상환액 (최종 대출금 기준)
            const finalMonthlyPayment = calculateMonthlyPayment(finalLoan, common.monthlyRate, common.totalMonths);

            // J. 최종 부족 자금
            const finalShortfall = Math.max(0, price - common.funds - finalLoan);

            // K. 최종 매매 가능 여부
            let finalVerdict = '';
            let finalColor = '';
            if (finalShortfall <= 0) {
                finalVerdict = '매매 가능';
                finalColor = 'accent-green';
            } else {
                finalVerdict = '자금 부족';
                finalColor = 'accent-red';
            }

            // --- 결과 업데이트 (DOM) ---
            // 1. 검토 결과
            document.getElementById('general-resultRequiredLoan').textContent = formatToBillion(requiredLoan);
            
            // *** 수정됨: 최대 대출금 표시 및 DSR 비율/주석 표시 ***
            document.getElementById('general-resultMaxLoan').textContent = maxLoanDisplay;
            document.getElementById('general-resultMaxLoan').className = `text-3xl font-bold ${maxLoanColor}`;
            document.getElementById('general-resultMaxLoanNote').innerHTML = maxLoanNote;

            document.getElementById('general-resultExpectedPMT').textContent = `${formatToWon(finalMonthlyPayment)} ( ${common.loanTerm}년, ${common.interestRate*100}% )`;
            
            // 2. Result
            document.getElementById('general-resultFunds').textContent = formatToBillion(common.funds);
            document.getElementById('general-resultFinalLoan').textContent = formatToBillion(finalLoan);
            document.getElementById('general-resultShortfall').textContent = formatToBillion(finalShortfall);
            
            const verdictContainer = document.getElementById('general-resultFinalVerdictContainer');
            verdictContainer.className = `p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-${finalColor}/10 border-${finalColor} text-${finalColor}`;
            document.getElementById('general-resultFinalVerdict').textContent = finalVerdict;
        };

        // 2. 청약 주택 계산 (직전 버전 로직 유지)
        const calculateSubscription = (common) => {
            const price = Number(document.getElementById('subscriptionPrice').value) * 100000000 || 0;
            const interimLoanRatio = Number(document.getElementById('interimLoanRatio').value) / 100 || 0.4;
            
            const dsrLimit = 0.40;
            const ltvRatio = common.ltvRatio;
            
            const ltvMaxLoan = price * ltvRatio;
            const dsrMaxAnnualPayment = common.income * dsrLimit;
            const dsrMaxMonthlyPayment = dsrMaxAnnualPayment / 12;

            let dsrMaxLoan = 0;
            if (common.monthlyRate > 0) {
                 dsrMaxLoan = calculateMaxLoanAmount(dsrMaxMonthlyPayment, common.monthlyRate, common.totalMonths);
            } else if (common.totalMonths > 0) {
                dsrMaxLoan = dsrMaxMonthlyPayment * common.totalMonths;
            }

            const interimLoanAmount = price * interimLoanRatio;
            const finalLoan = Math.min(dsrMaxLoan, ltvMaxLoan, interimLoanAmount);
            const finalMonthlyPayment = calculateMonthlyPayment(finalLoan, common.monthlyRate, common.totalMonths);

            const contractPayment = price * 0.10;
            const balancePayment = price * 0.30;
            const selfInterimPayment = Math.max(0, (price * 0.60) - finalLoan);
            const totalCashNeeded = contractPayment + balancePayment + selfInterimPayment;

            const finalShortfall = Math.max(0, totalCashNeeded - common.funds);
            
            let finalVerdict = '';
            let finalColor = '';
            if (finalShortfall <= 0) {
                finalVerdict = '청약 가능';
                finalColor = 'accent-green';
            } else {
                finalVerdict = '자금 부족';
                finalColor = 'accent-red';
            }

            // --- 결과 업데이트 (DOM) ---
            document.getElementById('sub-resultLTVMaxLoan').textContent = formatToBillion(ltvMaxLoan);
            document.getElementById('sub-resultDSRMaxLoan').textContent = formatToBillion(dsrMaxLoan);
            document.getElementById('sub-resultInterimLoanAmount').textContent = formatToBillion(interimLoanAmount);
            document.getElementById('sub-resultExpectedPMT').textContent = `${formatToWon(finalMonthlyPayment)} ( ${common.loanTerm}년, ${common.interestRate*100}% )`;

            document.getElementById('sub-resultFunds').textContent = formatToBillion(common.funds);
            document.getElementById('sub-resultFinalLoan').textContent = formatToBillion(finalLoan);
            document.getElementById('sub-resultShortfall').textContent = formatToBillion(finalShortfall);

            const verdictContainer = document.getElementById('sub-resultFinalVerdictContainer');
            verdictContainer.className = `p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-${finalColor}/10 border-${finalColor} text-${finalColor}`;
            document.getElementById('sub-resultFinalVerdict').textContent = finalVerdict;
        };
        
        // --- 메인 계산 함수 (버튼 클릭 시 호출) ---
        const calculate = () => {
            const commonInputs = getCommonInputs();
            
            if (activeMode === 'general') {
                calculateGeneral(commonInputs);
            } else if (activeMode === 'subscription') {
                calculateSubscription(commonInputs);
            }
        }

        // --- 모드 전환 함수 (드롭다운 변경 시 호출) ---
        const switchMode = (selectElement) => {
            const mode = selectElement.value;
            activeMode = mode;
            
            // 모드별 UI 전환
            document.querySelectorAll('[data-mode]').forEach(el => {
                if (el.getAttribute('data-mode') === mode) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });

            // 버튼 텍스트 및 스타일 변경
            const button = document.getElementById('calculateButton');
            if (mode === 'general') {
                button.textContent = '매매 가능성 검토 시작';
                button.className = 'w-full py-4 px-6 text-xl font-bold text-white bg-accent-green rounded-lg shadow-md hover:bg-green-700 calculate-button';
            } else {
                button.textContent = '청약 가능성 검토 시작';
                button.className = 'w-full py-4 px-6 text-xl font-bold text-white bg-primary-blue rounded-lg shadow-md hover:bg-blue-800 calculate-button';
            }

            // 규제지역 여부에 따른 LTV 표시 업데이트
            const commonInputs = getCommonInputs();
            const ltvRatio = commonInputs.ltvRatio;
            const regionText = commonInputs.isRegulated === 'Y' ? '규제지역' : '非규제지역';
            const ltvText = `${regionText} (${formatToPercent(ltvRatio)})`;
            document.getElementById('regulatedDisplay').textContent = ltvText;
            
            // 모드 변경 시 결과창 초기화
            clearResults();
        };

        // --- 결과창 초기화 함수 ---
        const clearResults = () => {
             // 일반 매매 결과 초기화
            document.getElementById('general-resultRequiredLoan').textContent = '0.00억';
            document.getElementById('general-resultMaxLoan').textContent = '입력 후 버튼을 눌러주세요.';
            document.getElementById('general-resultMaxLoan').className = 'text-3xl font-bold text-gray-900';
            document.getElementById('general-resultMaxLoanNote').innerHTML = ''; // HTML로 초기화
            document.getElementById('general-resultExpectedPMT').textContent = '0 원';
            document.getElementById('general-resultFunds').textContent = '0.00억';
            document.getElementById('general-resultFinalLoan').textContent = '0.00억';
            document.getElementById('general-resultShortfall').textContent = '0.00억';
            const genVerdictContainer = document.getElementById('general-resultFinalVerdictContainer');
            genVerdictContainer.className = 'p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600';
            document.getElementById('general-resultFinalVerdict').textContent = '데이터를 입력하고 검토해 보세요.';

            // 청약 결과 초기화
            document.getElementById('sub-resultLTVMaxLoan').textContent = '0.00억';
            document.getElementById('sub-resultDSRMaxLoan').textContent = '0.000억';
            document.getElementById('sub-resultInterimLoanAmount').textContent = '0.00억';
            document.getElementById('sub-resultExpectedPMT').textContent = '0 원';
            document.getElementById('sub-resultFunds').textContent = '0.00억';
            document.getElementById('sub-resultFinalLoan').textContent = '0.00억';
            document.getElementById('sub-resultShortfall').textContent = '0.00억';
            const subVerdictContainer = document.getElementById('sub-resultFinalVerdictContainer');
            subVerdictContainer.className = 'p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600';
            document.getElementById('sub-resultFinalVerdict').textContent = '데이터를 입력하고 검토해 보세요.';
        }

        // --- 초기 로드 및 이벤트 리스너 설정 ---
        document.addEventListener('DOMContentLoaded', () => {
            const modeSelector = document.getElementById('modeSelector');
            document.getElementById('isRegulated').addEventListener('change', () => {
                const commonInputs = getCommonInputs();
                const ltvRatio = commonInputs.ltvRatio;
                const regionText = commonInputs.isRegulated === 'Y' ? '규제지역' : '非규제지역';
                const ltvText = `${regionText} (${formatToPercent(ltvRatio)})`;
                document.getElementById('regulatedDisplay').textContent = ltvText;
            });
            
            // 모든 입력 필드에 oninput 이벤트 리스너 추가 (입력 값 변경 시 LTV 표시 업데이트를 위해)
            document.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('input', () => {
                    // 입력 시마다 결과 초기화는 하지 않음 (사용자 경험 개선)
                    // switchMode에서만 LTV 비율 업데이트 및 결과 초기화 수행
                });
            });

            switchMode(modeSelector);
        });
        
    </script>
</head>
<body class="bg-secondary-gray min-h-screen p-4 sm:p-8">

    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-2xl p-6 sm:p-10">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 타이틀/드롭다운 영역 -->
            <div class="lg:col-span-2">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-primary-blue mb-2">
                    주택 투자 시뮬레이터
                </h1>
                <p class="text-lg text-gray-600 mb-6">
                    선택하신 주택 유형에 따라 **LTV (주택 가격 기준)** 및 **DSR (소득 기준)** 한도를 계산합니다.
                </p>
                <div class="mb-8 p-4 border border-gray-300 rounded-lg bg-gray-50/50">
                    <label for="modeSelector" class="block text-lg font-bold text-gray-800 mb-2">
                        1. 주택 유형 선택
                    </label>
                    <select id="modeSelector" onchange="switchMode(this)" 
                        class="block w-full py-3 px-4 text-xl border border-gray-400 rounded-lg shadow-sm focus:border-primary-blue focus:ring-primary-blue transition duration-150 bg-white">
                        <option value="general">1. 일반 주택 매매</option>
                        <option value="subscription">2. 분양 주택 청약</option>
                    </select>
                </div>
            </div>

            <!-- 기재 항목 박스 (입력부) -->
            <div class="lg:col-span-1 p-5 border-2 border-gray-300 rounded-xl bg-gray-50 shadow-inner h-fit">
                <h2 class="text-2xl font-bold text-primary-blue mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    기재 항목 (필수 입력)
                </h2>
                
                <div class="space-y-4">
                    <!-- 1. 연 소득 -->
                    <div class="input-group">
                        <label for="income" class="block text-sm font-medium text-gray-700">✓ 연 소득 (부부합산, 세전)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="income" min="0.1" step="0.01"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="3">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억/년
                            </span>
                        </div>
                    </div>
                    <!-- 2. 보유 자금 -->
                    <div class="input-group">
                        <label for="funds" class="block text-sm font-medium text-gray-700">✓ 보유 자금</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="funds" min="0" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="30">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억
                            </span>
                        </div>
                    </div>
                    <!-- 3. 주택 가격 -->
                    <div id="general-inputs-price" data-mode="general">
                        <div class="input-group">
                            <label for="price" class="block text-sm font-medium text-gray-700">✓ 주택 매매가</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="number" id="price" min="0.1" step="0.1"
                                    class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="40">
                                <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                    억
                                </span>
                            </div>
                        </div>
                    </div>
                    <!-- 3-2. 청약 주택 전용 입력 -->
                    <div id="subscription-inputs" data-mode="subscription" class="hidden">
                        <div class="input-group mb-4">
                            <label for="subscriptionPrice" class="block text-sm font-medium text-gray-700">✓ 청약 분양가</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="number" id="subscriptionPrice" min="0.1" step="0.1"
                                    class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="40">
                                <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                    억
                                </span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="interimLoanRatio" class="block text-sm font-medium text-gray-700">✓ 건설사 중도금 알선 비율</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="number" id="interimLoanRatio" value="40" min="0" max="100" step="5"
                                    class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="40">
                                <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                    %
                                </span>
                            </div>
                        </div>
                    </div>
                    <hr class="border-gray-300">
                    <!-- 4. 나머지 공통 입력 -->
                    <div class="input-group">
                        <label for="interestRate" class="block text-sm font-medium text-gray-700">✓ 대출 금리 (시장 평균)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="interestRate" value="4.5" min="0.1" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="4.5">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                %
                            </span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="loanTerm" class="block text-sm font-medium text-gray-700">✓ 상환 기간 (주담대)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="loanTerm" value="30" min="1" step="1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="30">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                년
                            </span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="isRegulated" class="block text-sm font-medium text-gray-700">✓ 규제지역 여부</label>
                        <div class="mt-1 flex items-center justify-between rounded-md shadow-sm border border-gray-300 bg-white">
                            <select id="isRegulated" class="flex-1 block w-full rounded-md p-2 border-0 focus:border-primary-blue focus:ring-primary-blue transition duration-150">
                                <option value="N">N : 非규제지역</option>
                                <option value="Y">Y : 규제지역</option>
                            </select>
                            <span id="regulatedDisplay" class="inline-flex items-center px-3 text-gray-600 text-sm whitespace-nowrap">
                                <!-- JS가 이 부분을 채웁니다 -->
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 계산 버튼 영역 -->
            <div classs="lg:col-span-3">
                 <button id="calculateButton" onclick="calculate()" class="w-full py-4 px-6 text-xl font-bold text-white bg-accent-green rounded-lg shadow-md hover:bg-green-700 calculate-button">
                    매매 가능성 검토 시작
                </button>
            </div>

            <!-- 1. 일반 주택 매매 결과 섹션 (수정된 로직/UI 반영) -->
            <div id="general-results" data-mode="general" class="lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    3. 일반 주택 매매 검토 결과
                </h2>
                
                <div class="result-box p-6 space-y-4">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">검토 결과</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">필요 대출액 (매매가 - 보유자금)</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultRequiredLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">최대 대출금 (DSR/LTV 한도)</p>
                            <!-- 최대 대출금 (실제 최종 대출액) -->
                            <p class="text-3xl font-bold text-gray-900" id="general-resultMaxLoan">입력 후 버튼을 눌러주세요.</p>
                            <!-- DSR 비율 및 주석 (작은 글씨) -->
                            <div id="general-resultMaxLoanNote"></div>
                        </div>
                    </div>
                    <div>
                        <p class="text-lg font-medium text-gray-600 mb-1">예상 월 상환액 (최종 대출금 기준)</p>
                        <p class="text-3xl font-bold text-gray-900" id="general-resultExpectedPMT">0 원</p>
                    </div>

                    <hr class="border-gray-300 my-4">

                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">Result (최종 요약)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">보유 자금</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultFunds">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">최대 대출금</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultFinalLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">부족한 자금</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultShortfall">0.00억</p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-3 mt-8">
                    <div id="general-resultFinalVerdictContainer" class="p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600">
                        <span id="general-resultFinalVerdict">데이터를 입력하고 검토해 보세요.</span>
                    </div>
                </div>
            </div>
            
            <!-- 2. 청약 주택 결과 섹션 (직전 버전 로직 유지) -->
            <div id="subscription-results" data-mode="subscription" class="hidden lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    3. 분양 주택 청약 검토 결과
                </h2>

                <div class="result-box p-6 space-y-4">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">검토 결과</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">LTV 기준 최대 대출액</p>
                            <p class="text-3xl font-bold text-primary-blue" id="sub-resultLTVMaxLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">DSR 기준 최대 대출액</p>
                            <p class="text-3xl font-bold text-primary-blue" id="sub-resultDSRMaxLoan">0.000억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">건설사 중도금 알선 금액</p>
                            <p class="text-3xl font-bold text-accent-orange" id="sub-resultInterimLoanAmount">0.00억</p>
                        </div>
                    </div>
                    <div>
                        <p class="text-lg font-medium text-gray-600 mb-1">예상 월 상환액 (최종 대출액 기준)</p>
                        <p class="text-3xl font-bold text-gray-900" id="sub-resultExpectedPMT">0 원</p>
                    </div>

                    <hr class="border-gray-300 my-4">

                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">Result (최종 요약)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">보유 자금</T>
                            <p class="text-3xl font-bold text-gray-900" id="sub-resultFunds">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">최종 대출액 (한도 내)</p>
                            <p class="text-3xl font-bold text-gray-900" id="sub-resultFinalLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">부족한 자금</p>
                            <p class="text-3xl font-bold text-gray-900" id="sub-resultShortfall">0.00억</p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-3 mt-8">
                    <div id="sub-resultFinalVerdictContainer" class="p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600">
                        <span id="sub-resultFinalVerdict">데이터를 입력하고 검토해 보세요.</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-4">
                        * 청약 모드는 입주 시점에 필요한 총 대출금(분양가 - 보유자금)이 아닌, **DSR/LTV/알선액 중 최소 한도**를 '최종 대출액'으로 계산합니다.
                    </p>
                </div>
            </div>

        </div>
    </div>

</body>
</html>
