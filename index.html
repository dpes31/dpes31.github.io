<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주택 매매 가능 여부 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter 폰트 대신 한국어 환경에 적합한 시스템 기본 폰트 사용 */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; }
        .input-group input[type="number"]::-webkit-outer-spin-button,
        .input-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .input-group input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
    <script>
        // Tailwind CSS 설정 (색상 및 폰트)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1e40af', // Darker Blue
                        'secondary-gray': '#f3f4f6',
                        'accent-red': '#dc2626',
                        'accent-green': '#10b981',
                    },
                }
            }
        }

        // --- 재무 계산 함수 ---

        // 월별 이자율 계산 (r_m)
        const calculateMonthlyRate = (annualRate) => annualRate / 12;
        
        // 월별 대출 상환액 계산 (PMT)
        // P: 원금 (Principal), r_m: 월 이자율, m: 총 개월 수
        const calculateMonthlyPayment = (P, r_m, m) => {
            if (r_m === 0) return P / m; // 이자율 0% 가정
            const term = Math.pow(1 + r_m, m);
            return P * (r_m * term) / (term - 1);
        };

        // 최대 대출액 계산 (PV of Annuity - PMT의 역산)
        // A: 월 상환액, r_m: 월 이자율, m: 총 개월 수
        const calculateMaxLoanAmount = (A, r_m, m) => {
            if (r_m === 0) return A * m; // 이자율 0% 가정
            const term = Math.pow(1 + r_m, m);
            return A * (term - 1) / (r_m * term);
        };

        // 금액을 '억' 단위 문자열로 포맷 (예: 3000000000 -> 30.00억)
        const formatToBillion = (amount, decimals = 2) => {
            if (isNaN(amount) || amount === null) return '0.00억';
            const billion = amount / 100000000;
            return `${billion.toFixed(decimals)}억`;
        };

        // --- 주 로직 ---
        const updateCalculations = () => {
            const income = parseFloat(document.getElementById('income').value) * 100000000; // 억/년 -> 원/년
            const funds = parseFloat(document.getElementById('funds').value) * 100000000; // 억 -> 원
            const price = parseFloat(document.getElementById('price').value) * 100000000; // 억 -> 원
            
            // 대출 금리를 퍼센트(%)로 입력받아 100으로 나누어 소수점 형태로 변환 (예: 4.5 -> 0.045)
            const interestRateInput = parseFloat(document.getElementById('interestRate').value);
            const interestRate = interestRateInput / 100;
            
            const loanTerm = parseInt(document.getElementById('loanTerm').value); // 년
            const isRegulated = document.getElementById('isRegulated').value;

            // 결과 표시 요소
            const resultLTVMaxLoanEl = document.getElementById('resultLTVMaxLoan');
            const resultDSRMaxPaymentEl = document.getElementById('resultDSRMaxPayment');
            const resultDSRMaxLoanEl = document.getElementById('resultDSRMaxLoan');
            const resultRequiredLoanEl = document.getElementById('resultRequiredLoan');
            const resultActualAnnualPaymentEl = document.getElementById('resultActualAnnualPayment');
            const resultFinalVerdictEl = document.getElementById('resultFinalVerdict');
            const resultFinalVerdictContainerEl = document.getElementById('resultFinalVerdictContainer');

            // 1. DSR 및 LTV 계산을 위한 기본 파라미터
            const dsrLimit = 0.40; // DSR 40% 기준
            const ltvRatio = isRegulated === 'Y' ? 0.50 : 0.70; // 규제지역 50%, 비규제지역 70% (LTV 규제 비율)
            const monthlyRate = calculateMonthlyRate(interestRate);
            const totalMonths = loanTerm * 12;
            
            // LTV 규제 비율 업데이트
            document.getElementById('ltvRatioDisplay').textContent = `${(ltvRatio * 100).toFixed(0)}%`;


            // --- 1. LTV, DSR 최대 한도 검토 ---

            // A. LTV 기준 최대 대출액 (LTV 기준 최대 한도)
            const ltvMaxLoan = price * ltvRatio;
            resultLTVMaxLoanEl.textContent = formatToBillion(ltvMaxLoan);

            // B. DSR 허용 연간 상환액 (DSR 기준 최대 상환 가능액)
            const dsrMaxAnnualPayment = income * dsrLimit;
            const dsrMaxMonthlyPayment = dsrMaxAnnualPayment / 12;
            resultDSRMaxPaymentEl.textContent = formatToBillion(dsrMaxAnnualPayment, 3) + '/년';

            // C. DSR 기준 최대 대출액 (소득 기준으로 받을 수 있는 최대 대출액)
            let dsrMaxLoan = 0;
            if (monthlyRate > 0) {
                 dsrMaxLoan = calculateMaxLoanAmount(dsrMaxMonthlyPayment, monthlyRate, totalMonths);
            } else if (totalMonths > 0) {
                // 이자율 0%일 경우 단순 원금 균등 상환으로 가정
                dsrMaxLoan = dsrMaxMonthlyPayment * totalMonths;
            }
            resultDSRMaxLoanEl.textContent = formatToBillion(dsrMaxLoan, 3);

            // --- 2. FULL 대출 가능 여부 검토 ---

            // A. FULL 대출액 (필요한 대출 금액)
            const requiredLoan = Math.max(0, price - funds);
            resultRequiredLoanEl.textContent = formatToBillion(requiredLoan);

            // B. 연간 대출 상환액 (필요 대출 금액의 연간 원리금 상환액)
            let actualMonthlyPayment = 0;
            let actualAnnualPayment = 0;
            if (requiredLoan > 0 && interestRate > 0) {
                actualMonthlyPayment = calculateMonthlyPayment(requiredLoan, monthlyRate, totalMonths);
                actualAnnualPayment = actualMonthlyPayment * 12;
            } else if (requiredLoan > 0 && interestRate === 0) {
                // 이자율이 0%인 경우 원금만 상환
                actualMonthlyPayment = requiredLoan / totalMonths;
                actualAnnualPayment = actualMonthlyPayment * 12;
            }
            resultActualAnnualPaymentEl.textContent = formatToBillion(actualAnnualPayment, 3) + '/년';


            // --- 3. 최종 판단 및 결과 표시 ---
            
            // 실제 필요한 대출 금액(requiredLoan)을 빌리는 데 문제가 없는지 확인
            // 1) LTV 한도 내인가? (requiredLoan <= ltvMaxLoan)
            const isWithinLTV = requiredLoan <= ltvMaxLoan;
            
            // 2) DSR 한도 내인가? (actualAnnualPayment <= dsrMaxAnnualPayment)
            const isWithinDSR = actualAnnualPayment <= dsrMaxAnnualPayment;
            
            // 3) 대출이 필요한가? (requiredLoan > 0)
            const isLoanNeeded = requiredLoan > 0;
            
            let verdict = '';
            let color = '';

            if (requiredLoan === 0) {
                // 보유 자금이 매매가보다 크거나 같음 -> 대출 불필요
                verdict = '가능: 보유 자금으로 매매가 전액 충당 가능';
                color = 'accent-green';
            } else if (isWithinLTV && isWithinDSR) {
                // LTV와 DSR 모두 충족
                verdict = '가능: LTV 및 DSR 기준 모두 충족';
                color = 'accent-green';
            } else if (isLoanNeeded) {
                // 대출이 필요한 경우 문제점 파악
                verdict = '불가능: ';
                color = 'accent-red';
                
                if (!isWithinLTV && !isWithinDSR) {
                    verdict += 'LTV 및 DSR 기준 모두 초과';
                } else if (!isWithinLTV) {
                    verdict += 'LTV 기준 초과 (최대 대출액 ' + formatToBillion(ltvMaxLoan, 2) + ')';
                } else if (!isWithinDSR) {
                    verdict += 'DSR 기준 초과 (최대 상환액 ' + formatToBillion(dsrMaxAnnualPayment, 3) + '/년)';
                } else {
                    // 예외적인 경우 (이 로직에서는 발생하지 않아야 함)
                    verdict = '판단 불가';
                    color = 'gray-500';
                }
            } else {
                // 예외적인 경우
                 verdict = '판단 불가';
                 color = 'gray-500';
            }

            resultFinalVerdictContainerEl.className = `p-4 mt-6 text-xl font-bold rounded-lg shadow-md bg-${color}/10 border-2 border-${color} text-${color} flex items-center justify-center transition duration-300`;
            resultFinalVerdictEl.textContent = verdict;
        }


        // 규제지역 여부 텍스트 업데이트
        const updateRegulatedText = () => {
            const selectEl = document.getElementById('isRegulated');
            const displayEl = document.getElementById('regulatedDisplay');
            const selectedValue = selectEl.value;

            if (selectedValue === 'Y') {
                displayEl.textContent = '규제지역 (LTV 50%)';
            } else {
                displayEl.textContent = '非규제지역 (LTV 70%)';
            }
            updateCalculations(); // 변경 시 계산 다시 실행
        }
        
        // 초기 로드 시 및 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    // '규제지역 여부'는 별도 함수 호출
                    if (input.id === 'isRegulated') {
                        updateRegulatedText();
                    } else {
                        updateCalculations();
                    }
                });
            });

            // 초기값 설정 및 계산 실행
            updateRegulatedText(); // 초기값 'Y'에 맞춰 텍스트 업데이트 및 계산 실행
        });
        
    </script>
</head>
<body class="bg-secondary-gray min-h-screen p-4 sm:p-8">

    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-2xl p-6 sm:p-10">
        
        <!-- 이 섹션이 PC 환경에서 제목(왼쪽)과 입력 박스(오른쪽)를 분할하는 역할을 합니다. -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Title Section (PC: 2/3 폭) -->
            <div class="lg:col-span-2">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-primary-blue mb-2">
                    일반 주택 매매 계산기
                </h1>
                <p class="text-lg text-gray-600 mb-6">
                    주택 매매가, 소득, 보유 자금 등을 기준으로 대출 가능 여부를 검토합니다.
                </p>
            </div>

            <!-- Input Fields Box (기재 항목) - Right Side (PC: 1/3 폭, 테두리 유지) -->
            <div class="lg:col-span-1 p-5 border-2 border-primary-blue/30 rounded-xl bg-blue-50/50 shadow-inner">
                <h2 class="text-2xl font-bold text-primary-blue mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    기재 항목 (필수 입력)
                </h2>
                
                <div class="space-y-4">
                    <!-- 연 소득 -->
                    <div class="input-group">
                        <label for="income" class="block text-sm font-medium text-gray-700">✓ 연 소득 (부부합산, 세후)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="income" value="3" min="0.1" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="0.0">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억/년
                            </span>
                        </div>
                    </div>

                    <!-- 보유 자금 -->
                    <div class="input-group">
                        <label for="funds" class="block text-sm font-medium text-gray-700">✓ 보유 자금</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="funds" value="20" min="0" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="0.0">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억
                            </span>
                        </div>
                    </div>

                    <!-- 주택 매매가 -->
                    <div class="input-group">
                        <label for="price" class="block text-sm font-medium text-gray-700">✓ 주택 매매가</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="price" value="30" min="0.1" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="0.0">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억
                            </span>
                        </div>
                    </div>

                    <!-- 대출 금리 (수정된 부분: %로 입력) -->
                    <div class="input-group">
                        <label for="interestRate" class="block text-sm font-medium text-gray-700">✓ 대출 금리 (시장 평균)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="interestRate" value="4.5" min="0.1" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="4.5">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                %
                            </span>
                        </div>
                    </div>

                    <!-- 상환 기간 -->
                    <div class="input-group">
                        <label for="loanTerm" class="block text-sm font-medium text-gray-700">✓ 상환 기간</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="loanTerm" value="30" min="1" step="1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="30">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                년
                            </span>
                        </div>
                    </div>
                    
                    <!-- 규제지역 여부 -->
                    <div class="input-group">
                        <label for="isRegulated" class="block text-sm font-medium text-gray-700">✓ 규제지역 여부</label>
                        <div class="mt-1 flex items-center justify-between rounded-md shadow-sm border border-gray-300">
                            <select id="isRegulated" class="flex-1 block w-full rounded-md p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" onchange="updateRegulatedText()">
                                <option value="Y">규제지역</option>
                                <option value="N">非규제지역</option>
                            </select>
                            <span id="regulatedDisplay" class="inline-flex items-center px-3 text-gray-600 text-sm whitespace-nowrap">
                                규제지역 (LTV 50%)
                            </span>
                        </div>
                    </div>

                    <!-- LTV 규제 비율 (표시용) -->
                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700">✓ LTV 규제 비율</label>
                        <div class="mt-1 flex items-center rounded-md shadow-sm border border-gray-300 p-2 bg-gray-50">
                            <span id="ltvRatioDisplay" class="text-gray-900 font-semibold">50%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Result Section - LTV/DSR Max Limit -->
            <div class="lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    1) LTV, DSR 최대 한도 검토
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- LTV 기준 최대 대출액 -->
                    <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-primary-blue shadow-md">
                        <p class="text-lg font-medium text-gray-600 mb-1">LTV 기준 최대 대출액</p>
                        <p class="text-3xl font-bold text-gray-900" id="resultLTVMaxLoan">0.00억</p>
                        <p class="text-sm text-gray-500 mt-1">주택 가격 대비 LTV 한도 내 최대 대출액</p>
                    </div>

                    <!-- DSR 기준 최대 상환 가능액 -->
                    <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-primary-blue shadow-md">
                        <p class="text-lg font-medium text-gray-600 mb-1">DSR 기준 최대 상환 가능액</p>
                        <p class="text-3xl font-bold text-gray-900" id="resultDSRMaxPayment">0.000억/년</p>
                        <p class="text-sm text-gray-500 mt-1">DSR 40% 기준, 현 소득으로 연간 상환 가능한 최대 금액</p>
                    </div>

                    <!-- DSR 기준 최대 대출액 -->
                    <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-primary-blue shadow-md">
                        <p class="text-lg font-medium text-gray-600 mb-1">DSR 기준 최대 대출액</p>
                        <p class="text-3xl font-bold text-gray-900" id="resultDSRMaxLoan">0.000억</p>
                        <p class="text-sm text-gray-500 mt-1">소득 기준으로 받을 수 있는 최대 대출액</p>
                    </div>
                </div>
            </div>
            
            <!-- Result Section - Required Loan & Actual Payment -->
            <div class="lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    2) 필요 대출 및 실제 상환 부담 검토
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- FULL 대출액 (필요 대출 금액) -->
                    <div class="bg-red-50 p-5 rounded-lg border-l-4 border-accent-red shadow-md">
                        <p class="text-lg font-medium text-gray-600 mb-1">필요 대출액 (매매가 - 보유자금)</p>
                        <p class="text-3xl font-bold text-gray-900" id="resultRequiredLoan">0.00억</p>
                        <p class="text-sm text-gray-500 mt-1">주택 매매가를 충당하기 위해 실제로 필요한 대출 금액</p>
                    </div>

                    <!-- 연간 대출 상환액 -->
                    <div class="bg-red-50 p-5 rounded-lg border-l-4 border-accent-red shadow-md">
                        <p class="text-lg font-medium text-gray-600 mb-1">연간 대출 상환액 (원리금 균등)</p>
                        <p class="text-3xl font-bold text-gray-900" id="resultActualAnnualPayment">0.000억/년</p>
                        <p class="text-sm text-gray-500 mt-1">필요 대출액을 대출받았을 때 예상되는 연간 원리금 상환 부담</p>
                    </div>
                </div>
            </div>

            <!-- Final Verdict -->
            <div class="lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    3) 최종 투자 가능 여부 판단
                </h2>
                
                <div id="resultFinalVerdictContainer" class="p-4 mt-6 text-xl font-bold rounded-lg shadow-md flex items-center justify-center transition duration-300">
                    <span id="resultFinalVerdict">데이터를 입력하고 검토해 보세요.</span>
                </div>
            </div>

        </div>
    </div>

</body>
</html>
