<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주택 투자 시뮬레이터 (v2: 청약 비율 수정)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* (디자인 스타일은 이전과 동일하게 유지) */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
        .input-group input[type="number"]::-webkit-outer-spin-button,
        .input-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        .input-group input[type="number"] { -moz-appearance: textfield; }
        .result-box {
            background-color: #f3f4f6; 
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        /* 버튼 스타일 */
        .calculate-button {
            transition: background-color 0.3s ease;
        }
        /* DSR 비율 및 주석 작은 글씨 스타일 */
        .small-text-note {
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* text-gray-500 */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1e40af', 
                        'secondary-gray': '#f3f4f6',
                        'accent-red': '#dc2626',
                        'accent-green': '#10b981',
                        'accent-orange': '#f97316',
                    },
                }
            }
        }
        let activeMode = 'general';
        
        // --- 재무 함수 ---
        const calculateMonthlyRate = (annualRate) => annualRate / 12;
        
        // 원리금 균등 상환 방식의 월 상환액 계산 (PMT)
        const calculateMonthlyPayment = (P, r_m, m) => {
            if (r_m === 0 || m === 0) return (P / (m || 1)); 
            const term = Math.pow(1 + r_m, m);
            return P * (r_m * term) / (term - 1);
        };

        // 월 상환액 기준 최대 대출 금액 계산 (PV)
        const calculateMaxLoanAmount = (A, r_m, m) => {
            if (r_m === 0 || m === 0) return A * (m || 1); 
            const term = Math.pow(1 + r_m, m);
            return A * (term - 1) / (r_m * term);
        };

        // --- 포맷팅 함수 ---
        const formatToBillion = (amount, decimals = 2) => {
            if (isNaN(amount) || amount === null || amount === undefined) return '0.00억';
            const billion = amount / 100000000;
            if (Math.abs(billion) < 0.01) return `${Math.round(amount).toLocaleString()} 원`;
            return `${billion.toFixed(decimals)}억`;
        };
        const formatToWon = (amount) => {
            if (isNaN(amount) || amount === null || amount === undefined) return '0 원';
            return `${Math.round(amount).toLocaleString()} 원`;
        }
        const formatToPercent = (rate) => {
            if (isNaN(rate) || rate === null || rate === undefined) return '0%';
            return `${(rate * 100).toFixed(0)}%`;
        };
        
        // --- 공통 입력값 파싱 ---
        const getCommonInputs = () => {
            const income = Number(document.getElementById('income').value) * 100000000 || 0;
            const funds = Number(document.getElementById('funds').value) * 100000000 || 0;
            const interestRate = Number(document.getElementById('interestRate').value) / 100 || 0.045;
            const loanTerm = parseInt(document.getElementById('loanTerm').value) || 30;
            const isRegulated = document.getElementById('isRegulated').value;
            
            const monthlyRate = calculateMonthlyRate(interestRate);
            const totalMonths = loanTerm * 12;
            const ltvRatio = isRegulated === 'Y' ? 0.50 : 0.70;

            return { 
                income, funds, interestRate, loanTerm, isRegulated, 
                monthlyRate, totalMonths, ltvRatio
            };
        }

        // --- 모드별 계산 로직 ---
        // 1. 일반 주택 매매 계산 (*** 수정된 로직: 최대 대출금 타이틀 및 노트 변경 ***)
        const calculateGeneral = (common) => {
            const price = Number(document.getElementById('price').value) * 100000000 || 0;
            
            const dsrLimit = 0.40;
            const ltvRatio = common.ltvRatio;
            
            const ltvMaxLoan = price * ltvRatio;
            const dsrMaxAnnualPayment = common.income * dsrLimit;
            const dsrMaxMonthlyPayment = dsrMaxAnnualPayment / 12;
            
            let dsrMaxLoan = calculateMaxLoanAmount(dsrMaxMonthlyPayment, common.monthlyRate, common.totalMonths);

            const requiredLoan = Math.max(0, price - common.funds);
            let requiredAnnualPayment = 0;
            if (requiredLoan > 0) {
                const requiredMonthlyPayment = calculateMonthlyPayment(requiredLoan, common.monthlyRate, common.totalMonths);
                requiredAnnualPayment = requiredMonthlyPayment * 12;
            }
            
            const dsrRatio = (dsrMaxAnnualPayment > 0) ? (requiredAnnualPayment / dsrMaxAnnualPayment) : (requiredAnnualPayment > 0 ? Infinity : 0);
            const bankMaxLoan = Math.min(ltvMaxLoan, dsrMaxLoan);

            // DSR ratio text for the dynamic label (Request A)
            const dsrRatioText = dsrRatio === Infinity ? '계산 불가' : `${dsrRatio.toFixed(2)}배`;
            
            // Note generation (Request B: Static text + Warning)
            let maxLoanNote = `<span class="small-text-note">(DSR 비율 1배 이하일 경우 필요 대출액 실행 가능)</span>`;

            let finalLoan = 0;
            let maxLoanDisplay = '';
            let maxLoanColor = 'text-gray-900';

            if (price === 0) {
                maxLoanDisplay = '주택 매매가를 입력해주세요.';
                maxLoanColor = 'text-gray-500';
                maxLoanNote = ''; // Clear note if price is 0
            } else if (requiredLoan === 0) {
                finalLoan = 0;
                maxLoanDisplay = `대출 필요 없음`;
                maxLoanColor = 'text-accent-green';
            } else if (dsrRatio <= 1) {
                finalLoan = Math.min(requiredLoan, bankMaxLoan);
                maxLoanDisplay = formatToBillion(finalLoan);
                maxLoanColor = 'text-accent-green';
            } else {
                finalLoan = bankMaxLoan; 
                maxLoanDisplay = formatToBillion(finalLoan);
                maxLoanColor = 'text-accent-red';
                // Add DSR excess warning if ratio > 1
                maxLoanNote += `<span class="small-text-note block mt-1 font-bold text-accent-red">※ 필요 대출액 불가 (DSR 초과). 최대 한도 금액을 빌려도 자금이 부족할 수 있습니다.</span>`;
            }

            const finalMonthlyPayment = calculateMonthlyPayment(finalLoan, common.monthlyRate, common.totalMonths);
            const finalShortfall = Math.max(0, price - common.funds - finalLoan);

            let finalVerdict = '';
            let finalColor = '';
            if (price === 0) {
                finalVerdict = '주택 가격을 입력해주세요.';
                finalColor = 'gray-500';
            } else if (finalShortfall <= 0) {
                finalVerdict = '매매 가능';
                finalColor = 'accent-green';
            } else {
                finalVerdict = '자금 부족';
                finalColor = 'accent-red';
            }

            // --- 결과 업데이트 (DOM) ---
            // Update the label to include the dynamic DSR ratio (Request A)
            document.getElementById('general-resultMaxLoanLabel').textContent = `최대 대출금 (DSR 비율 : ${dsrRatioText})`;
            
            document.getElementById('general-resultRequiredLoan').textContent = formatToBillion(requiredLoan);
            document.getElementById('general-resultMaxLoan').textContent = maxLoanDisplay;
            document.getElementById('general-resultMaxLoan').className = `text-3xl font-bold ${maxLoanColor}`;
            // Update the note text (Request B)
            document.getElementById('general-resultMaxLoanNote').innerHTML = maxLoanNote; 
            
            document.getElementById('general-resultExpectedPMT').textContent = `${formatToWon(finalMonthlyPayment)} ( ${common.loanTerm}년, ${common.interestRate*100}% )`;
            document.getElementById('general-resultPrice').textContent = formatToBillion(price); 
            document.getElementById('general-resultFunds').textContent = formatToBillion(common.funds);
            document.getElementById('general-resultFinalLoan').textContent = formatToBillion(finalLoan);
            document.getElementById('general-resultShortfall').textContent = formatToBillion(finalShortfall);
            
            const verdictContainer = document.getElementById('general-resultFinalVerdictContainer');
            verdictContainer.className = verdictContainer.className.replace(/bg-(accent-green|accent-red|gray-100)\/\d+/, '').replace(/border-(accent-green|accent-red|gray-300)/, '').replace(/text-(accent-green|accent-red|gray-600)/, '');
            verdictContainer.className = `p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-${finalColor}/10 border-${finalColor} text-${finalColor}`;
            document.getElementById('general-resultFinalVerdict').textContent = finalVerdict;
        };

        // 2. 청약 주택 계산
        const calculateSubscription = (common) => {
            const price = Number(document.getElementById('subscriptionPrice').value) * 100000000 || 0;
            
            // 1. Get Ratios from new inputs
            const contractRatioInput = Number(document.getElementById('contractRatio').value) / 100 || 0.10;
            const balanceRatioInput = Number(document.getElementById('balanceRatio').value) / 100 || 0.30;
            const interimLoanAssistRatio = Number(document.getElementById('interimLoanRatio').value) / 100 || 0.4;
            
            // 비율 합산이 100%를 초과하지 않도록 보정 (계약금 + 잔금)
            let contractRatio = contractRatioInput;
            let balanceRatio = balanceRatioInput;
            const totalCashRatio = contractRatioInput + balanceRatioInput;

            if (totalCashRatio > 1.0) {
                // 비율이 100%를 초과하면, 남은 중도금 비율이 없으므로 계약금/잔금 비율을 조정
                const scale = 1.0 / totalCashRatio;
                contractRatio = contractRatioInput * scale;
                balanceRatio = balanceRatioInput * scale;
                // 에러 메시지 등을 표시할 수 있으나, 현재는 자동 보정으로 진행
            }

            // 중도금 비율 = 100% - 계약금% - 잔금%
            const totalInterimRatio = Math.max(0, 1.0 - contractRatio - balanceRatio); 

            // DSR, LTV 설정
            const dsrLimit = 0.40;
            const ltvRatio = common.ltvRatio;
            
            // 1. LTV 기준 최대 대출액
            const ltvMaxLoan = price * ltvRatio;

            // 2. DSR 기준 최대 대출액
            const dsrMaxAnnualPayment = common.income * dsrLimit;
            const dsrMaxMonthlyPayment = dsrMaxAnnualPayment / 12;
            let dsrMaxLoan = calculateMaxLoanAmount(dsrMaxMonthlyPayment, common.monthlyRate, common.totalMonths);

            // 3. 건설사 중도금 알선 금액 (Total Price * Loan Assist Ratio)
            const interimLoanAmountLimit = price * interimLoanAssistRatio; 
            
            // 4. 최종 대출 가능 금액 (입주 시 주담대 전환 기준)
            const finalLoan = Math.min(dsrMaxLoan, ltvMaxLoan, interimLoanAmountLimit);
            
            // 5. 청약 대금 구성 및 현금 흐름 계산
            const contractPayment = price * contractRatio; // 계약금 (Cash Out)
            const balancePayment = price * balanceRatio; // 잔금 (Cash Out)
            const totalInterimPayment = price * totalInterimRatio; // 총 중도금

            // 6. 자납 중도금 (총 중도금 - 최종 대출로 커버되는 금액)
            const selfInterimPayment = Math.max(0, totalInterimPayment - finalLoan); // (Cash Out)

            // 7. 건설사 알선 중도금 (최종 대출로 커버되는 중도금 부분)
            const loanCoveredInterimPayment = Math.min(totalInterimPayment, finalLoan); 
            
            // 8. 총 필요 현금 (지출 총액) = 계약금 + 잔금 + 자납 중도금
            const totalCashRequired = contractPayment + balancePayment + selfInterimPayment;

            // 9. 최종 부족 자금
            const finalShortfall = Math.max(0, totalCashRequired - common.funds);
            
            // 10. 최종 월 상환액
            const finalMonthlyPayment = calculateMonthlyPayment(finalLoan, common.monthlyRate, common.totalMonths);
            
            // 11. 표시용 비율 계산 (총 분양가 기준)
            const loanCoveredInterimRatio = price > 0 ? loanCoveredInterimPayment / price : 0;
            const selfInterimRatio = price > 0 ? selfInterimPayment / price : 0;
            
            let finalVerdict = '';
            let finalColor = '';
            if (price === 0) {
                finalVerdict = '청약 분양가를 입력해주세요.';
                finalColor = 'gray-500';
            } else if (finalShortfall <= 0) {
                finalVerdict = '청약 가능';
                finalColor = 'accent-green';
            } else {
                finalVerdict = '자금 부족';
                finalColor = 'accent-red';
            }

            // --- 결과 업데이트 (DOM) ---
            document.getElementById('sub-resultLTVMaxLoan').textContent = formatToBillion(ltvMaxLoan);
            document.getElementById('sub-resultDSRMaxLoan').textContent = formatToBillion(dsrMaxLoan);
            document.getElementById('sub-resultInterimLoanAmount').textContent = formatToBillion(interimLoanAmountLimit); // 알선 한도 금액 표시
            document.getElementById('sub-resultExpectedPMT').textContent = `${formatToWon(finalMonthlyPayment)} ( ${common.loanTerm}년, ${common.interestRate*100}% )`;
            document.getElementById('sub-resultMaxPossibleLoan').textContent = formatToBillion(finalLoan);

            // 2. Result (현금 흐름 요약) - 업데이트된 항목
            document.getElementById('sub-flowPrice').textContent = formatToBillion(price);
            
            // 계약금 (금액 + 비율)
            document.getElementById('sub-flowContract').textContent = `${formatToBillion(contractPayment, 2)} (${formatToPercent(contractRatio)})`;
            // 잔금 (금액 + 비율)
            document.getElementById('sub-flowBalance').textContent = `${formatToBillion(balancePayment, 2)} (${formatToPercent(balanceRatio)})`;
            // 자납 중도금 (금액 + 비율)
            document.getElementById('sub-flowSelfInterim').textContent = `${formatToBillion(selfInterimPayment, 2)} (${formatToPercent(selfInterimRatio)})`;
            // 건설사 알선 중도금 대출 (금액 + 비율)
            document.getElementById('sub-flowLoanCoveredInterim').textContent = `${formatToBillion(loanCoveredInterimPayment, 2)} (${formatToPercent(loanCoveredInterimRatio)})`;


            document.getElementById('sub-flowTotalRequiredCash').textContent = formatToBillion(totalCashRequired, 2); 
            document.getElementById('sub-flowFunds').textContent = formatToBillion(common.funds, 2); 
            document.getElementById('sub-flowFinalLoan').textContent = formatToBillion(finalLoan, 2);
            document.getElementById('sub-flowShortfall').textContent = formatToBillion(finalShortfall, 2); 

            const verdictContainer = document.getElementById('sub-resultFinalVerdictContainer');
            verdictContainer.className = verdictContainer.className.replace(/bg-(accent-green|accent-red|gray-100)\/\d+/, '').replace(/border-(accent-green|accent-red|gray-300)/, '').replace(/text-(accent-green|accent-red|gray-600)/, '');
            verdictContainer.className = `p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-${finalColor}/10 border-${finalColor} text-${finalColor}`;
            document.getElementById('sub-resultFinalVerdict').textContent = finalVerdict;
        };
        
        // --- 메인 계산 함수 (버튼 클릭 시 호출) ---
        const calculate = () => {
            const commonInputs = getCommonInputs();
            
            if (activeMode === 'general') {
                calculateGeneral(commonInputs);
            } else if (activeMode === 'subscription') {
                calculateSubscription(commonInputs);
            }
        }

        // --- 모드 전환 함수 (드롭다운 변경 시 호출) ---
        const switchMode = (selectElement) => {
            const mode = selectElement.value;
            activeMode = mode;
            
            document.querySelectorAll('[data-mode]').forEach(el => {
                if (el.getAttribute('data-mode') === mode) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });

            const button = document.getElementById('calculateButton');
            if (mode === 'general') {
                button.textContent = '매매 가능성 검토 시작';
                button.className = 'w-full py-4 px-6 text-xl font-bold text-white bg-accent-green rounded-lg shadow-md hover:bg-green-700 calculate-button';
            } else {
                button.textContent = '청약 가능성 검토 시작';
                button.className = 'w-full py-4 px-6 text-xl font-bold text-white bg-primary-blue rounded-lg shadow-md hover:bg-blue-800 calculate-button';
            }

            const commonInputs = getCommonInputs();
            const ltvRatio = commonInputs.ltvRatio;
            const regionText = commonInputs.isRegulated === 'Y' ? '규제지역' : '非규제지역';
            const ltvText = `${regionText} (${formatToPercent(ltvRatio)})`;
            document.getElementById('regulatedDisplay').textContent = ltvText;
            
            clearResults();
        };

        // --- 결과창 초기화 함수 ---
        const clearResults = () => {
             // 일반 매매 결과 초기화
            document.getElementById('general-resultRequiredLoan').textContent = '0.00억';
            // Reset the label content (Request A reset)
            document.getElementById('general-resultMaxLoanLabel').textContent = '최대 대출금 (DSR 비율 : 00배)';

            document.getElementById('general-resultMaxLoan').textContent = '입력 후 버튼을 눌러주세요.';
            document.getElementById('general-resultMaxLoan').className = 'text-3xl font-bold text-gray-900';
            document.getElementById('general-resultMaxLoanNote').innerHTML = ''; 
            document.getElementById('general-resultExpectedPMT').textContent = '0 원';
            document.getElementById('general-resultPrice').textContent = '0.00억'; 
            document.getElementById('general-resultFunds').textContent = '0.00억';
            document.getElementById('general-resultFinalLoan').textContent = '0.00억';
            document.getElementById('general-resultShortfall').textContent = '0.00억';
            const genVerdictContainer = document.getElementById('general-resultFinalVerdictContainer');
            genVerdictContainer.className = 'p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600';
            document.getElementById('general-resultFinalVerdict').textContent = '데이터를 입력하고 검토해 보세요.';

            // 청약 결과 초기화
            document.getElementById('sub-resultLTVMaxLoan').textContent = '0.00억';
            document.getElementById('sub-resultDSRMaxLoan').textContent = '0.00억';
            document.getElementById('sub-resultInterimLoanAmount').textContent = '0.00억';
            document.getElementById('sub-resultExpectedPMT').textContent = '0 원';
            document.getElementById('sub-resultMaxPossibleLoan').textContent = '0.00억'; 
            
            // 현금 흐름 요약 초기화
            document.getElementById('sub-flowPrice').textContent = '0.00억';
            document.getElementById('sub-flowContract').textContent = '0.00억 (0%)';
            document.getElementById('sub-flowBalance').textContent = '0.00억 (0%)';
            document.getElementById('sub-flowSelfInterim').textContent = '0.00억 (0%)';
            document.getElementById('sub-flowLoanCoveredInterim').textContent = '0.00억 (0%)';

            document.getElementById('sub-flowTotalRequiredCash').textContent = '0.00억';
            document.getElementById('sub-flowFunds').textContent = '0.00억';
            document.getElementById('sub-flowFinalLoan').textContent = '0.00억';
            document.getElementById('sub-flowShortfall').textContent = '0.00억';
            
            const subVerdictContainer = document.getElementById('sub-resultFinalVerdictContainer');
            subVerdictContainer.className = 'p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600';
            document.getElementById('sub-resultFinalVerdict').textContent = '데이터를 입력하고 검토해 보세요.';
        }

        // --- 초기 로드 및 이벤트 리스너 설정 ---
        document.addEventListener('DOMContentLoaded', () => {
            const modeSelector = document.getElementById('modeSelector');
            const isRegulatedElement = document.getElementById('isRegulated');
            
            isRegulatedElement.addEventListener('change', () => {
                const commonInputs = getCommonInputs();
                const ltvRatio = commonInputs.ltvRatio;
                const regionText = commonInputs.isRegulated === 'Y' ? '규제지역' : '非규제지역';
                const ltvText = `${regionText} (${formatToPercent(ltvRatio)})`;
                document.getElementById('regulatedDisplay').textContent = ltvText;
            });
            
            switchMode(modeSelector);

            // 모든 입력값 변경 시 결과 초기화 (재계산 유도)
            document.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('input', () => {
                    clearResults();
                });
            });
        });
        
    </script>
</head>
<body class="bg-secondary-gray min-h-screen p-4 sm:p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-2xl p-6 sm:p-10">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 타이틀/드롭다운 영역 -->
            <div class="lg:col-span-2">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-primary-blue mb-2">
                    주택 투자 시뮬레이터
                </p>
                <div class="mb-8 p-4 border border-gray-300 rounded-lg bg-gray-50/50">
                    <label for="modeSelector" class="block text-lg font-bold text-gray-800 mb-2">
                        1. 주택 유형 선택
                    </label>
                    <select id="modeSelector" onchange="switchMode(this)" 
                        class="block w-full py-3 px-4 text-xl border border-gray-400 rounded-lg shadow-sm focus:border-primary-blue focus:ring-primary-blue transition duration-150 bg-white">
                        <option value="general">1. 일반 주택 매매</option>
                        <option value="subscription">2. 분양 주택 청약</option>
                    </select>
                </div>
            </div>
            <!-- 기재 항목 박스 (입력부) -->
            <div class="lg:col-span-1 p-5 border-2 border-gray-300 rounded-xl bg-gray-50 shadow-inner h-fit">
                <h2 class="text-2xl font-bold text-primary-blue mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    기재 항목 (필수 입력)
                </h2>
                
                <div class="space-y-4">
                    <!-- 1. 연 소득 -->
                    <div class="input-group">
                        <label for="income" class="block text-sm font-medium text-gray-700"> ✓  연 소득 (부부합산, 세전)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="income" min="0.1" step="0.01"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="3" value="0">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억/년
                            </span>
                        </div>
                    </div>
                    <!-- 2. 보유 자금 -->
                    <div class="input-group">
                        <label for="funds" class="block text-sm font-medium text-gray-700"> ✓  보유 자금</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="funds" min="0" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="30" value="0">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                억
                            </span>
                        </div>
                    </div>
                    <!-- 3. 주택 가격 -->
                    <div id="general-inputs-price" data-mode="general">
                        <div class="input-group">
                            <label for="price" class="block text-sm font-medium text-gray-700"> ✓  주택 매매가</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="number" id="price" min="0.1" step="0.1"
                                    class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="40" value="0">
                                <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                    억
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3-2. 청약 주택 전용 입력 (수정된 레이아웃) -->
                    <div id="subscription-inputs" data-mode="subscription" class="hidden space-y-4">
                        <!-- 분양가 -->
                        <div class="input-group">
                            <label for="subscriptionPrice" class="block text-sm font-medium text-gray-700"> ✓  청약 분양가</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="number" id="subscriptionPrice" min="0.1" step="0.1"
                                    class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="40" value="0">
                                <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                    억
                                </span>
                            </div>
                        </div>
                        
                        <!-- 신규 3분할 레이아웃 -->
                        <div class="grid grid-cols-3 gap-2">
                            <!-- 1. 계약금 비율 (신규) -->
                            <div class="input-group">
                                <label for="contractRatio" class="block text-sm font-medium text-gray-700"> ✓ 계약금</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="number" id="contractRatio" value="10" min="0" max="100" step="1"
                                        class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="10">
                                    <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                        %
                                    </span>
                                </div>
                            </div>
                            <!-- 2. 중도금 알선 비율 (이동) -->
                            <div class="input-group">
                                <label for="interimLoanRatio" class="block text-sm font-medium text-gray-700"> ✓ 중도금 알선</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="number" id="interimLoanRatio" value="40" min="0" max="100" step="5"
                                        class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="40">
                                    <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                        %
                                    </span>
                                </div>
                            </div>
                            <!-- 3. 잔금 비율 (신규) -->
                            <div class="input-group">
                                <label for="balanceRatio" class="block text-sm font-medium text-gray-700"> ✓ 잔금</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="number" id="balanceRatio" value="30" min="0" max="100" step="1"
                                        class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="30">
                                    <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                        %
                                    </span>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 text-center col-span-3 -mt-2">
                            * 중도금 알선 : 건설사에서 제공하는 융자 알선 비율
                            * 중도금 : (100% - 계약금% - 잔금%)로 자동 계산
                        </p>
                    </div>
                    <!-- (수정 완료) -->


                    <hr class="border-gray-300">
                    <!-- 4. 나머지 공통 입력 -->
                    <div class="input-group">
                        <label for="interestRate" class="block text-sm font-medium text-gray-700"> ✓  대출 금리 (시장 평균)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="interestRate" value="4.5" min="0.1" step="0.1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="4.5">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                %
                            </span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="loanTerm" class="block text-sm font-medium text-gray-700"> ✓  상환 기간 (주담대)</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="loanTerm" value="30" min="1" step="1"
                                class="flex-1 block w-full rounded-l-md border-gray-300 p-2 focus:border-primary-blue focus:ring-primary-blue transition duration-150" placeholder="30">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                년
                            </span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="isRegulated" class="block text-sm font-medium text-gray-700"> ✓  규제지역 여부</label>
                        <div class="mt-1 flex items-center justify-between rounded-md shadow-sm border border-gray-300 bg-white">
                            <select id="isRegulated" class="flex-1 block w-full rounded-md p-2 border-0 focus:border-primary-blue focus:ring-primary-blue transition duration-150">
                                <option value="N">N : 非규제지역</option>
                                <option value="Y">Y : 규제지역</option>
                            </select>
                            <span id="regulatedDisplay" class="inline-flex items-center px-3 text-gray-600 text-sm whitespace-nowrap">
                                <!-- JS가 이 부분을 채웁니다 -->
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 계산 버튼 영역 -->
            <div class="lg:col-span-3">
                 <button id="calculateButton" onclick="calculate()" class="w-full py-4 px-6 text-xl font-bold text-white bg-accent-green rounded-lg shadow-md hover:bg-green-700 calculate-button">
                    매매 가능성 검토 시작
                </button>
            </div>

            <!-- 1. 일반 주택 매매 결과 섹션 (*** 수정된 HTML: 최대 대출금 라벨/노트 ***) -->
            <div id="general-results" data-mode="general" class="lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    3. 주택 매매 검토 결과
                </h2>
                <div class="result-box p-6 space-y-4">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">검토 결과</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">필요 대출액 (매매가 - 보유자금)</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultRequiredLoan">0.00억</p>
                        </div>
                        <div>
                            <!-- 라벨 수정: DSR 비율 동적 표시를 위한 ID 추가 및 텍스트 수정 -->
                            <p class="text-lg font-medium text-gray-600 mb-1" id="general-resultMaxLoanLabel">최대 대출금 (DSR 비율 : 00배)</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultMaxLoan">입력 후 버튼을 눌러주세요.</p>
                            <!-- 노트 영역 -->
                            <div id="general-resultMaxLoanNote"></div>
                        </div>
                    </div>
                    <div>
                        <p class="text-lg font-medium text-gray-600 mb-1">예상 월 상환액 (최종 대출금 기준)</p>
                        <p class="text-3xl font-bold text-gray-900" id="general-resultExpectedPMT">0 원</p>
                    </div>
                    <hr class="border-gray-300 my-4">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">Result (최종 요약)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">주택 매매가</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultPrice">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">보유 자금</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultFunds">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">최대 대출금</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultFinalLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">부족한 자금</p>
                            <p class="text-3xl font-bold text-gray-900" id="general-resultShortfall">0.00억</p>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-3 mt-8">
                    <div id="general-resultFinalVerdictContainer" class="p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600">
                        <span id="general-resultFinalVerdict">데이터를 입력하고 검토해 보세요.</span>
                    </div>
                </div>
            </div>
            
            <!-- 2. 청약 주택 결과 섹션 -->
            <div id="subscription-results" data-mode="subscription" class="hidden lg:col-span-3 mt-8">
                <h2 class="text-3xl font-extrabold text-primary-blue border-b pb-2 mb-6">
                    3. 주택 청약 검토 결과
                </h2>
                <div class="result-box p-6 space-y-4">
                    <!-- 대출 한도 계산 요약 -->
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">대출 가능 한도 검토</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">LTV 기준 최대 대출액</p>
                            <p class="text-3xl font-bold text-primary-blue" id="sub-resultLTVMaxLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">DSR 기준 최대 대출액</p>
                            <p class="text-3xl font-bold text-primary-blue" id="sub-resultDSRMaxLoan">0.00억</p>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-gray-600 mb-1">건설사 중도금 알선 한도</p>
                            <p class="text-3xl font-bold text-accent-orange" id="sub-resultInterimLoanAmount">0.00억</p>
                        </div>
                    </div>
                    <div class="md:col-span-3 p-4 mt-4 bg-primary-blue/10 rounded-lg border border-primary-blue">
                        <p class="text-xl font-medium text-primary-blue mb-1">최대 대출 가능 금액 (입주 시 주담대 전환액)</p>
                        <p class="text-4xl font-extrabold text-primary-blue" id="sub-resultMaxPossibleLoan">0.00억</p>
                    </div>
                    <div class="mt-4">
                        <p class="text-lg font-medium text-gray-600 mb-1">예상 월 상환액 (최종 대출액 기준)</p>
                        <p class="text-3xl font-bold text-gray-900" id="sub-resultExpectedPMT">0 원</p>
                    </div>
                    <hr class="border-gray-300 my-8">

                    <!-- 현금 흐름 요약 (Cash Flow Summary) -->
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">분양 대금 구성 및 현금 조달 계획</h3>
                    <div class="space-y-2 text-xl">
                        <!-- 1. 분양가 (Total Price) -->
                        <div class="flex justify-between items-center py-2 border-b">
                            <span class="text-gray-600">분양가 (Total Price)</span>
                            <span class="font-bold text-gray-900" id="sub-flowPrice">0.00억</span>
                        </div>
                        
                        <!-- 2. 계약금 (현금 지출) -->
                        <div class="flex justify-between items-center py-2 border-b border-dotted">
                            <span class="text-gray-600">현금 지출: 계약금</span>
                            <span class="font-bold text-accent-red" id="sub-flowContract">0.00억 (0%)</span>
                        </div>
                        
                        <!-- 3. 잔금 (현금 지출) -->
                        <div class="flex justify-between items-center py-2 border-b border-dotted">
                            <span class="text-gray-600">현금 지출: 잔금</span>
                            <span class="font-bold text-accent-red" id="sub-flowBalance">0.00억 (0%)</span>
                        </div>

                        <!-- 4. 자납 중도금 (현금 지출) -->
                        <div class="flex justify-between items-center py-2 border-b border-dotted">
                            <span class="text-gray-600">현금 지출: 자납 중도금 (대출 초과분)</span>
                            <span class="font-bold text-accent-red" id="sub-flowSelfInterim">0.00억 (0%)</span>
                        </div>
                        
                        <!-- 총 필요 현금 (지출 총액) -->
                        <div class="flex justify-between items-center py-2 border-b border-b-2 border-gray-900/50">
                            <span class="text-lg font-extrabold text-gray-800">총 필요 현금 (지출 총액)</span>
                            <span class="text-lg font-extrabold text-gray-900" id="sub-flowTotalRequiredCash">0.00억</span>
                        </div>

                        <div class="pt-4"></div>

                        <!-- 5. 최종 대출액 (자금 조달) -->
                        <div class="flex justify-between items-center py-2 border-b border-t-2 border-primary-blue/50">
                            <span class="text-xl font-bold text-gray-800">자금 조달: 최종 대출액 </span>
                            <span class="font-bold text-accent-green" id="sub-flowFinalLoan">0.00억</span>
                        </div>
                        
                        <!-- 알선 중도금 대출 전환분 (참고 정보) -->
                        <div class="flex justify-between items-center py-2 border-b border-dotted pl-4 text-sm">
                            <span class="text-gray-500">└건설사 알선 중도금 대출</span>
                            <span class="font-bold text-gray-700" id="sub-flowLoanCoveredInterim">0.00억 (0%)</span> 
                        </div>
                        
                        <!-- 6. 보유 자금 (자금 조달) -->
                        <div class="flex justify-between items-center py-2">
                            <span class="text-xl font-bold text-gray-800">자금 조달: 보유 자금</span>
                            <span class="text-3xl font-extrabold text-gray-900" id="sub-flowFunds">0.00억</span>
                        </div>
                        
                        <!-- 7. 부족한 자금 (최종 결과) -->
                        <div class="flex justify-between items-center py-2 pt-4 bg-secondary-gray rounded-lg">
                            <span class="text-xl font-bold text-gray-800">부족한 자금</span>
                            <span class="text-3xl font-extrabold text-accent-red" id="sub-flowShortfall">0.00억</span>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-3 mt-8">
                    <div id="sub-resultFinalVerdictContainer" class="p-4 mt-6 text-xl font-bold rounded-lg shadow-md border-2 text-center transition duration-300 bg-gray-100 border-gray-300 text-gray-600">
                        <span id="sub-resultFinalVerdict">데이터를 입력하고 검토해 보세요.</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-4">
                        * '최종 대출액'은 **DSR/LTV/알선액 중 가장 낮은 금액**을 기준으로 산출된 최대 대출 가능 금액을 의미하며, 해당 금액이 입주 시점에 주택담보대출로 전환된다고 가정하고 계산합니다.<br>
                        * '총 필요 현금'은 청약을 위해 순수하게 현금으로 지출해야 하는 **(계약금 + 잔금 + 자납 중도금)**의 합계입니다.
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
