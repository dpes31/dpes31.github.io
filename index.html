<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 부동산 투자 시뮬레이터</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 16px; background: #f8f9fa; color: #212529; line-height: 1.5; }
        h1 { font-size: 1.5rem; text-align: center; margin: 0 0 24px; }
        .desc { text-align: center; font-size: 0.9rem; color: #6c757d; margin-bottom: 24px; }
        form { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        label { display: block; font-size: 0.95rem; font-weight: 600; margin: 16px 0 6px; }
        input, select { width: 100%; padding: 12px; font-size: 1rem; border: 1.5px solid #ced4da; border-radius: 8px; background: #fff; }
        input:focus, select:focus { border-color: #007bff; outline: none; }
        input::placeholder { color: #adb5bd; }
        .underline { text-decoration: underline; text-decoration-color: #007bff; text-decoration-thickness: 2px; }
        .mid-loan { display: none; }
        .special-note { display: none; background: #e7f3ff; padding: 12px; border-radius: 8px; margin-top: 8px; font-size: 0.9rem; }
        button { margin-top: 24px; width: 100%; padding: 14px; background: #007bff; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; }
        button:active { background: #0056b3; }
        #result { margin-top: 32px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: none; }
        .section { margin-bottom: 32px; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 1px solid #dee2e6; }
        .section h3 { margin: 0 0 16px; font-size: 1.2rem; color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 8px; }
        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ced4da; font-size: 1rem; }
        .item:last-child { border-bottom: none; }
        .item strong { color: #212529; }
        .amount { font-weight: bold; color: #007bff; }
        .big-amount { font-size: 1.8rem; font-weight: bold; color: #d9480f; }
        .final-loan { background: #ffe5e5; border: 3px solid #dc3545; padding: 16px; border-radius: 12px; text-align: center; }
        .summary { background: #fff9db; padding: 20px; border-radius: 12px; border: 2px solid #ffc107; }
        .summary .item { font-size: 1.1rem; padding: 12px 0; }
        .highlight { color: #007bff; font-weight: bold; font-size: 1.3rem; }
        .possible { color: #28a745; font-weight: bold; font-size: 1.4rem; }
        .impossible { color: #dc3545; font-weight: bold; font-size: 1.4rem; }
        table { width: 100%; border-collapse: collapse; margin: 16px 0; }
        th, td { padding: 8px; border: 1px solid #dee2e6; text-align: center; }
        th { background: #e7f3ff; }
        #interest-section { margin-top: 32px; padding: 20px; background: #f8f9fa; border-radius: 12px; }
        #interest-section h3 { font-size: 1.1rem; margin: 0 0 16px; color: #495057; text-align: center; }
        .repay-box { display: flex; justify-content: space-around; gap: 16px; }
        .repay-card { flex: 1; background: white; padding: 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
        .repay-card.recommend { border: 3px solid #007bff; }
        .repay-card h4 { margin: 0 0 8px; font-size: 1rem; color: #495057; }
        .repay-card .monthly { font-size: 1.4rem; font-weight: bold; color: #007bff; margin: 8px 0; }
        .repay-card small { display: block; color: #6c757d; font-size: 0.8rem; margin-top: 8px; line-height: 1.4; }
        .tip-box { margin-top: 32px; padding: 16px; background: #e9f7ff; border-left: 4px solid #007bff; border-radius: 0 8px 8px 0; font-size: 0.9rem; color: #495057; line-height: 1.6; }
        .tip-box strong { color: #007bff; }
        .small-note { font-size: 0.8rem; color: #6c757d; margin-top: 16px; }
        .sub-item { padding-left: 20px; font-size: 0.95rem; color: #495057; }
        .convertible { color: #dc3545; font-weight: bold; }
        .self-mid { color: #007bff; font-weight: bold; }
        .ltv-display { font-size: 1.2rem; font-weight: bold; color: #d9480f; margin: 12px 0; text-align: center; background: #fff; padding: 12px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>2025 부동산 투자 시뮬레이터</h1>
    <p class="desc">규제지역만 선택 → LTV 자동 (2025.11.10 최신)</p>

    <form id="simulatorForm">
        <label>주택 유형</label>
        <select id="type" onchange="toggleMidLoan(); updateLTV()">
            <option value="buy">일반 매매</option>
            <option value="lottery">청약/분양</option>
        </select>

        <label>주택 가격 (억 원)</label>
        <input type="number" id="price" placeholder="10" step="0.1" oninput="updateLTV(); showLotteryLimit()">

        <div id="lottery-limit" style="display:none; background:#e7f3ff; padding:8px; border-radius:6px; font-size:0.9rem; margin:8px 0;"></div>

        <label>투자 지역</label>
        <select id="region" onchange="updateLTV()">
            <option value="regulated">규제지역 (서울·수도권)</option>
            <option value="non">비규제지역 (지방)</option>
        </select>

        <label>보유 주택 수</label>
        <select id="houses" onchange="updateLTV()">
            <option value="0">무주택</option>
            <option value="1">1주택</option>
            <option value="multi">다주택</option>
        </select>

        <label>서민·실수요자 우대</label>
        <select id="special" onchange="updateLTV()">
            <option value="no">아니오</option>
            <option value="yes">예</option>
        </select>
        <div id="special-note" class="special-note">
            우대: 무주택 세대주, 소득 ~1억, 주택 9억 이하. 규제 70% / 비규제 80%
        </div>

        <div class="ltv-display" id="ltv-display">LTV: 계산 중...</div>

        <label>보유 자산 (억 원)</label>
        <input type="number" id="assets" placeholder="3" step="0.1">

        <label>연간 소득 (세전, 억 원)</label>
        <input type="number" id="income" placeholder="1" step="0.1">

        <div class="mid-loan">
            <label>건설사 중도금 대출 비율 (%)</label>
            <input type="number" id="midLoanRate" placeholder="40" step="5" min="0" max="60">
        </div>

        <label>대출 금리 (%)</label>
        <input type="number" id="interestRate" placeholder="3.3" step="0.1">

        <button type="button" onclick="calculate()">계산하기</button>
    </form>

    <div id="result">
        <h2 style="margin-top:0; font-size:1.3rem; text-align:center;">투자 분석 결과</h2>

        <div class="section">
            <h3>1. 대출 한도 및 최대 대출금</h3>
            <div class="final-loan" id="final-loan-detail"></div>
            <div id="loan-breakdown"></div>
            <table id="limit-table">
                <tr><th>분양가 범위</th><th>대출 한도</th></tr>
                <tr><td>15억 이하</td><td>6억</td></tr>
                <tr><td>15~25억</td><td>4억</td></tr>
                <tr><td>25억 초과</td><td>2억</td></tr>
            </table>
        </div>

        <div class="section">
            <h3>2. 청약 개요 및 나갈 돈</h3>
            <div id="outlay-items"></div>
            <p class="small-note">양도세·복비 미반영</p>
        </div>

        <div class="section summary">
            <h3>총 정리</h3>
            <div id="total-summary"></div>
            <p id="feasibility" style="text-align:center; margin:20px 0 0;"></p>
        </div>

        <div id="interest-section">
            <h3><span id="total-loan-display"></span>억 대출 월 상환 (30년)</h3>
            <div class="repay-box">
                <div class="repay-card recommend">
                    <h4>원금 균등 (추천)</h4>
                    <div class="monthly" id="monthly-equal-principal"></div>
                    <small>총이자 ↓</small>
                </div>
                <div class="repay-card">
                    <h4>원리금 균등</h4>
                    <div class="monthly" id="monthly-level-payment"></div>
                    <small>매월 동일</small>
                </div>
            </div>
        </div>

        <div class="tip-box">
            <strong>2025 규제</strong><br>
            • 규제지역 기본 40% (우대 70%)<br>
            • 비규제 기본 70% (우대 80%)<br>
            • 다주택 0%
        </div>
    </div>

    <script>
        const reg = {
            dsrMultiplier: 5.625,
            lotteryLimit: { low: 6, high15: 4, high25: 2 },
            costs: { tax: 0.015, etc: 0.1 },
            defaultRate: 3.3
        };

        let currentLTV = 0;

        function toggleMidLoan() {
            const isLottery = document.getElementById('type').value === 'lottery';
            document.querySelector('.mid-loan').style.display = isLottery ? 'block' : 'none';
            document.getElementById('lottery-limit').style.display = 'none';
            if (isLottery) showLotteryLimit();
        }

        function showLotteryLimit() {
            const price = parseFloat(document.getElementById('price').value) || 0;
            let cap = reg.lotteryLimit.low;
            if (price > 25) cap = reg.lotteryLimit.high25;
            else if (price > 15) cap = reg.lotteryLimit.high15;
            document.getElementById('lottery-limit').innerHTML = `청약 대출 한도: ${cap}억 원`;
            document.getElementById('lottery-limit').style.display = 'block';
        }

        function updateLTV() {
            const region = document.getElementById('region').value;
            const houses = document.getElementById('houses').value;
            const special = document.getElementById('special').value;
            const price = parseFloat(document.getElementById('price').value) || 0;

            document.getElementById('special-note').style.display = special === 'yes' ? 'block' : 'none';

            if (houses === 'multi') {
                currentLTV = 0;
                document.getElementById('ltv-display').innerHTML = '다주택: LTV 0% (대출 불가)';
                return;
            }

            const base = region === 'regulated' ? 0.4 : 0.7;
            currentLTV = special === 'yes' ? (region === 'regulated' ? 0.7 : 0.8) : base;

            document.getElementById('ltv-display').innerHTML = `LTV ${currentLTV * 100}% → 최대 ${ (price * currentLTV).toFixed(1) }억`;
        }

        function calculate() {
            const type = document.getElementById('type').value;
            const price = parseFloat(document.getElementById('price').value) || 0;
            const assets = parseFloat(document.getElementById('assets').value) || 0;
            const income = parseFloat(document.getElementById('income').value) || 0;
            const midRate = type === 'lottery' ? parseFloat(document.getElementById('midLoanRate').value) || 40 : 0;
            const rate = parseFloat(document.getElementById('interestRate').value) || reg.defaultRate;

            const ltvAmt = price * currentLTV;
            const dsrAmt = income * reg.dsrMultiplier;

            let cap = reg.lotteryLimit.low;
            if (price > 25) cap = reg.lotteryLimit.high25;
            else if (price > 15) cap = reg.lotteryLimit.high15;

            let finalLoan = type === 'buy' ? Math.min(ltvAmt, dsrAmt) : Math.min(ltvAmt, dsrAmt, cap);
            const minSource = finalLoan === ltvAmt ? 'LTV' : finalLoan === dsrAmt ? 'DSR' : '분양가 한도';

            const midTotal = type === 'lottery' ? price * 0.6 : 0;
            const midLoanPossible = price * (midRate / 100);
            const midExcess = midLoanPossible > finalLoan ? midLoanPossible - finalLoan : 0;
            const midConvertible = midLoanPossible - midExcess;
            const selfMid = midTotal - midConvertible;

            const tax = price * reg.costs.tax;
            const etc = reg.costs.etc;
            const totalCost = tax + etc;

            const contract = price * 0.1;
            const balance = price * 0.3;

            const totalOutlay = contract + selfMid + balance + totalCost;
            const remain = assets - totalOutlay;
            const ok = remain >= 0;

            document.getElementById('final-loan-detail').innerHTML = `
                <div class="big-amount">${finalLoan.toFixed(1)}억</div>
                <p>${minSource} 기준</p>
            `;
            document.getElementById('loan-breakdown').innerHTML = `
                <div class="item"><strong>건설사 알선 (${midRate}%)</strong> <span class="amount">${midLoanPossible.toFixed(1)}억</span></div>
                <div class="item"><strong>분양가 한도</strong> <span class="amount">${cap.toFixed(1)}억</span></div>
                <div class="item"><strong>LTV (${currentLTV*100}%)</strong> <span class="amount">${ltvAmt.toFixed(1)}억</span></div>
                <div class="item"><strong>DSR</strong> <span class="amount">${dsrAmt.toFixed(1)}억</span></div>
            `;

            let outlayHtml = `<div class="item"><strong>분양가</strong> <span class="amount">${price.toFixed(1)}억</span></div>
                <div class="item"><strong>총 나갈 돈</strong> <span class="big-amount">${totalOutlay.toFixed(1)}억</span></div>
                <div class="item"><strong>├ 계약금 10%</strong> <span class="amount">${contract.toFixed(1)}억</span></div>`;
            if (type === 'lottery') {
                outlayHtml += `<div class="item"><strong>├ 중도금 60%</strong> <span class="amount">${midTotal.toFixed(1)}억</span></div>
                    <div class="sub-item"><strong>│ ├ 전환 대출</strong> <span class="convertible">${midConvertible.toFixed(1)}억</span></div>
                    <div class="sub-item"><strong>│ └ 자납</strong> <span class="self-mid">${selfMid.toFixed(1)}억</span></div>
                    <div class="item"><strong>├ 잔금 30%</strong> <span class="amount">${balance.toFixed(1)}억</span></div>`;
            }
            outlayHtml += `<div class="item"><strong>├ 추가 비용</strong> <span class="amount">${totalCost.toFixed(2)}억</span></div>`;
            document.getElementById('outlay-items').innerHTML = outlayHtml;

            document.getElementById('total-summary').innerHTML = `
                <div class="item"><strong>가격</strong> <span class="amount">${price.toFixed(1)}억</span></div>
                <div class="item"><strong>나갈 돈</strong> <span class="amount">${totalOutlay.toFixed(1)}억</span></div>
                <div class="item"><strong>대출</strong> <span class="amount">${finalLoan.toFixed(1)}억</span></div>
                <div class="item"><strong>자산</strong> <span class="amount">${assets.toFixed(1)}억</span></div>
                <div class="item" style="border-top:3px double #ced4da;"><strong>잔여</strong> <span class="highlight">${remain.toFixed(1)}억</span></div>
            `;

            const remainText = remain >= 0 ? `${remain.toFixed(1)}억 여유` : `${Math.abs(remain).toFixed(1)}억 부족`;
            document.getElementById('feasibility').innerHTML = `<span class="${ok ? 'possible' : 'impossible'}">${ok ? '가능' : '불가'} (${remainText})</span>`;

            const P = finalLoan * 100000000;
            const r = rate / 100 / 12;
            const n = 360;
            const avgEqual = P / n + (P * r + P / n * r) / 2;
            const level = r > 0 ? P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1) : P / n;

            document.getElementById('monthly-equal-principal').innerHTML = `${Math.round(avgEqual / 10000).toLocaleString()}만원`;
            document.getElementById('monthly-level-payment').innerHTML = `${Math.round(level / 10000).toLocaleString()}만원`;
            document.getElementById('total-loan-display').innerHTML = finalLoan.toFixed(1);

            document.getElementById('result').style.display = 'block';
            window.scrollTo({ top: document.getElementById('result').offsetTop - 20, behavior: 'smooth' });
        }

        updateLTV();
        toggleMidLoan();
    </script>
</body>
</html>
